'\" t
.\" Automatically generated by Pandoc 3.1.3
.\"
.\" Define V font for inline verbatim, using C font in formats
.\" that render this, and otherwise B font.
.ie "\f[CB]x\f[]"x" \{\
. ftr V B
. ftr VI BI
. ftr VB B
. ftr VBI BI
.\}
.el \{\
. ftr V CR
. ftr VI CI
. ftr VB CB
. ftr VBI CBI
.\}
.TH "files2xml" "1" "May 08, 2025" "files2xml declare -r XML_VERSION=`1.0'" "User Manual"
.hy
.PP
[IMAGE: License:
GPL-3.0 (https://img.shields.io/badge/License-GPL--3.0-blue.svg)] (https://www.gnu.org/licenses/gpl-3.0)
.RS
.PP
Convert files to XML representation with complete metadata and content
.RE
.SS Overview
.PP
\f[V]files2xml\f[R] is a robust Bash utility that creates standardized
XML representations of files, including their metadata and content.
It automatically handles both text and binary files appropriately,
embedding text content within CDATA sections and encoding binary content
as base64.
.PP
This tool is designed for: - Archiving file content with metadata -
Documenting filesystem contents - Transferring file data over XML-based
protocols - Integrating with XML processing pipelines - Creating file
inventories for analysis
.SS Features
.IP \[bu] 2
\f[B]Intelligent Content Handling\f[R]:
.RS 2
.IP \[bu] 2
Automatically detects binary vs text files using MIME encoding
.IP \[bu] 2
Text files are embedded as CDATA sections with proper XML escaping
.IP \[bu] 2
Binary files are base64-encoded
.IP \[bu] 2
Handles CDATA end sequences (\f[V]]]>\f[R]) properly in text files
.IP \[bu] 2
Special error handling for problematic files
.RE
.IP \[bu] 2
\f[B]Comprehensive Metadata\f[R]:
.RS 2
.IP \[bu] 2
Full file path (\f[V]fqfn\f[R]) as absolute canonical path
.IP \[bu] 2
MIME type (\f[V]type\f[R]) using the file utility
.IP \[bu] 2
File size in bytes (\f[V]size\f[R])
.IP \[bu] 2
Modification timestamp (\f[V]modified\f[R]) in ISO 8601 format
.RE
.IP \[bu] 2
\f[B]Directory Support\f[R]:
.RS 2
.IP \[bu] 2
Process entire directories recursively
.IP \[bu] 2
Intelligently skip common irrelevant directories for performance
.IP \[bu] 2
Combine files and directories in a single command
.IP \[bu] 2
Smart directory pruning to avoid traversing ignored directories
.RE
.IP \[bu] 2
\f[B]Git Integration\f[R]:
.RS 2
.IP \[bu] 2
Process all tracked files from Git repositories
.IP \[bu] 2
Combine multiple repositories in a single command
.IP \[bu] 2
Works alongside explicit file specifications
.IP \[bu] 2
Preserves working directory when processing git repositories
.RE
.IP \[bu] 2
\f[B]Robust Processing\f[R]:
.RS 2
.IP \[bu] 2
Configurable maximum file size limit (default: 1GB)
.IP \[bu] 2
Custom file ignore patterns with glob support
.IP \[bu] 2
Proper symlink resolution to canonical paths
.IP \[bu] 2
Detailed error handling with continued processing
.IP \[bu] 2
Full XML escaping for paths and filenames
.IP \[bu] 2
Automatic file deduplication using canonical paths
.RE
.IP \[bu] 2
\f[B]Size Optimization\f[R]:
.RS 2
.IP \[bu] 2
Content compression with gzip (\f[V]-c/--compress\f[R])
.IP \[bu] 2
Content omission for metadata-only output (\f[V]-n/--no-content\f[R])
.IP \[bu] 2
XML minification for compact output (\f[V]-M/--minify\f[R])
.IP \[bu] 2
All options can be combined for minimal output size
.RE
.IP \[bu] 2
\f[B]Flexibility\f[R]:
.RS 2
.IP \[bu] 2
Outputs to stdout for pipeline integration
.IP \[bu] 2
Can be sourced in other Bash scripts as a library
.IP \[bu] 2
Configurable verbosity levels (normal, quiet, verbose)
.IP \[bu] 2
Compatible with standard XML processing tools
.RE
.SS Installation
.SS Prerequisites
.IP \[bu] 2
\f[B]Operating System\f[R]: Ubuntu 24.04.2 or compatible Linux
distribution
.IP \[bu] 2
\f[B]Bash\f[R]: Version 5.2.21 or higher (required for associative
arrays)
.IP \[bu] 2
\f[B]Required utilities\f[R]: basename, file, stat, date, sed, base64,
readlink, numfmt, getopt
.IP \[bu] 2
\f[B]Optional\f[R]: Git (for repository integration), gzip (for
compression), xmlstarlet/xmllint (for XML processing)
.SS Quick Install
.IP
.nf
\f[C]
# Clone the repository
git clone https://github.com/Open-Technology-Foundation/files2xml.git
cd files2xml

# Make the script executable
chmod +x files2xml

# Run a simple test
\&./files2xml --version

# Optionally, install system-wide (requires sudo privileges)
sudo cp files2xml /usr/local/bin/

# Verify the installation
files2xml --help
\f[R]
.fi
.SS Dependency Verification
.PP
To verify all dependencies are installed and available:
.IP
.nf
\f[C]
# Check for missing dependencies
\&./files2xml --help 2>&1 | grep \[dq]Required command not found\[dq]
\f[R]
.fi
.PP
If no output is produced, all required commands are available in your
system.
.SS Usage
.IP
.nf
\f[C]
files2xml [OPTIONS] [FILE|DIRECTORY ...]
\f[R]
.fi
.SS Arguments
.IP \[bu] 2
\f[V]FILE|DIRECTORY\f[R] - One or more files or directories to include
in the XML (optional if \[en]gitdir is used)
.SS Options
.IP \[bu] 2
\f[V]-m, --max-file-size SIZE\f[R] - Set maximum file size (default:
1GB)
.RS 2
.IP \[bu] 2
Uses human-readable format (e.g., \[lq]1G\[rq], \[lq]500M\[rq],
\[lq]10K\[rq])
.RE
.IP \[bu] 2
\f[V]-g, --gitdir DIR\f[R] - Include files from git repository (can be
used multiple times)
.IP \[bu] 2
\f[V]-i, --ignore PATTERN\f[R] - Add glob pattern to ignore list (can be
used multiple times)
.RS 2
.IP \[bu] 2
Default file patterns:
\f[V]\[aq]*.mp*\[aq] \[aq]\[ti]*\[aq] \[aq]*\[ti]\[aq] \[aq]*.bak\[aq] \[aq]*.log\[aq] \[aq]*.old\[aq] \[aq]*LI*\[aq]\f[R]
.IP \[bu] 2
Default dir patterns:
\f[V]\[aq]__pycache__/*\[aq] \[aq].cache/*\[aq] \[aq].venv/*\[aq] \[aq]venv/*\[aq] \[aq].gudang/*\[aq] \[aq]gudang/*\[aq]\f[R]
.IP \[bu] 2
Use \f[V]-i \[dq]\[dq]\f[R] to clear the default patterns
.RE
.IP \[bu] 2
\f[V]-c, --compress\f[R] - Enable gzip compression for file content
(reduces XML size)
.IP \[bu] 2
\f[V]-n, --no-content\f[R] - Exclude file content (metadata only,
significantly reduces XML size)
.IP \[bu] 2
\f[V]-M, --minify\f[R] - Produce minified XML output (no indentation or
extra whitespace)
.IP \[bu] 2
\f[V]-v, --verbose\f[R] - Increase verbosity (can be used multiple
times)
.IP \[bu] 2
\f[V]-q, --quiet\f[R] - Suppress all messages
.IP \[bu] 2
\f[V]-V, --version\f[R] - Show version information
.IP \[bu] 2
\f[V]-h, --help\f[R] - Show help message
.SS Examples
.SS Basic Usage
.PP
Process specific files:
.IP
.nf
\f[C]
files2xml file1.txt file2.pdf > files.xml
\f[R]
.fi
.SS Directory Processing
.PP
Process a directory recursively:
.IP
.nf
\f[C]
files2xml /path/to/directory > directory_files.xml
\f[R]
.fi
.PP
Mix files and directories:
.IP
.nf
\f[C]
files2xml file1.txt /path/to/directory file2.pdf > mixed.xml
\f[R]
.fi
.SS Git Repository Integration
.PP
Process all tracked files in a Git repository:
.IP
.nf
\f[C]
files2xml --gitdir /path/to/repo > repo_files.xml
\f[R]
.fi
.PP
Combine multiple Git repositories:
.IP
.nf
\f[C]
files2xml --gitdir /path/to/repo1 --gitdir /path/to/repo2 > combined.xml
\f[R]
.fi
.PP
Mix Git repositories, directories, and specific files:
.IP
.nf
\f[C]
files2xml --gitdir /path/to/repo additional_file.txt /some/directory > combined.xml
\f[R]
.fi
.SS File Filtering
.PP
Specify custom ignore patterns (adds to default patterns):
.IP
.nf
\f[C]
files2xml --ignore \[dq]*.tmp\[dq] --ignore \[dq]*.cache\[dq] dir/*.py > files.xml
\f[R]
.fi
.PP
Clear default ignore patterns and set custom ones:
.IP
.nf
\f[C]
files2xml --ignore \[dq]\[dq] --ignore \[dq]*.tmp\[dq] --gitdir /path/to/repo > files.xml
\f[R]
.fi
.SS Size Optimization
.PP
Generate smaller XML with compression:
.IP
.nf
\f[C]
files2xml --compress /path/to/directory > compressed.xml
\f[R]
.fi
.PP
Generate metadata-only XML (no file content, much smaller):
.IP
.nf
\f[C]
files2xml --no-content /path/to/directory > metadata_only.xml
\f[R]
.fi
.PP
Generate minified XML (no whitespace or formatting):
.IP
.nf
\f[C]
files2xml --minify /path/to/directory > minified.xml
\f[R]
.fi
.PP
Combine all size-reduction options for smallest possible XML:
.IP
.nf
\f[C]
files2xml --compress --no-content --minify /path/to/directory > smallest.xml
\f[R]
.fi
.SS Integration with Other Tools
.PP
Process multiple files with find:
.IP
.nf
\f[C]
find . -type f -name \[dq]*.py\[dq] -exec files2xml {} + > output.xml
\f[R]
.fi
.PP
Extract specific file information with xmlstarlet:
.IP
.nf
\f[C]
# List all shell script filenames
files2xml *.sh | xmlstarlet sel -t -m \[dq]//file[contains(\[at]type,\[aq]shellscript\[aq])]\[dq] -v \[dq]\[at]fqfn\[dq] -n

# Get sizes of all text files
files2xml docs/* | xmlstarlet sel -t -m \[dq]//file[contains(\[at]type,\[aq]text\[aq])]\[dq] -v \[dq]concat(\[at]fqfn,\[aq]: \[aq],\[at]size,\[aq] bytes\[aq])\[dq] -n

# Extract content from specific files
files2xml config.json | xmlstarlet sel -t -m \[dq]//file[\[at]fqfn=\[aq]/absolute/path/to/config.json\[aq]]\[dq] -v \[dq]content\[dq] -n

# Find all files larger than 1MB
files2xml --gitdir . | xmlstarlet sel -t -m \[dq]//file[number(\[at]size) > 1048576]\[dq] -v \[dq]concat(\[at]fqfn,\[aq] (\[aq],\[at]size,\[aq] bytes)\[aq])\[dq] -n
\f[R]
.fi
.SS File Size Limits
.PP
Set a custom maximum file size:
.IP
.nf
\f[C]
files2xml --max-file-size 10M large_directory/* > files.xml
\f[R]
.fi
.SS XML Format
.PP
The script generates XML with the following structure:
.IP
.nf
\f[C]
<?xml version=\[dq]1.0\[dq] encoding=\[dq]UTF-8\[dq]?>
<Files>
  <!-- Text file example -->
  <file fqfn=\[dq]/absolute/path/to/file.txt\[dq] type=\[dq]text/plain\[dq] size=\[dq]1234\[dq] modified=\[dq]2025-04-15T10:30:45\[dq]>
    <content><![CDATA[File content goes here...]]></content>
  </file>
  
  <!-- Binary file example -->
  <file fqfn=\[dq]/absolute/path/to/image.png\[dq] type=\[dq]image/png\[dq] size=\[dq]5678\[dq] modified=\[dq]2025-04-15T11:25:30\[dq]>
    <content encoding=\[dq]base64\[dq]>base64encodedcontent...</content>
  </file>
  
  <!-- Compressed file example -->
  <file fqfn=\[dq]/absolute/path/to/document.pdf\[dq] type=\[dq]application/pdf\[dq] size=\[dq]9012\[dq] modified=\[dq]2025-04-15T12:20:15\[dq]>
    <content encoding=\[dq]base64\[dq] compression=\[dq]gzip\[dq]>compressedbase64content...</content>
  </file>
  
  <!-- Error example -->
  <file fqfn=\[dq]/path/to/unreadable.dat\[dq] type=\[dq]application/octet-stream\[dq] size=\[dq]9999\[dq] modified=\[dq]2025-04-15T12:15:00\[dq]>
    <content error=\[dq]failed_to_encode\[dq]/>
  </file>
  
  <!-- Metadata-only example -->
  <file fqfn=\[dq]/path/to/config.json\[dq] type=\[dq]application/json\[dq] size=\[dq]2468\[dq] modified=\[dq]2025-04-15T13:45:30\[dq]>
    <content excluded=\[dq]metadata_only\[dq]/>
  </file>
</Files>
\f[R]
.fi
.SS XML Attributes
.PP
.TS
tab(@);
lw(32.1n) lw(37.9n).
T{
Attribute
T}@T{
Description
T}
_
T{
\f[V]fqfn\f[R]
T}@T{
Fully qualified file name (absolute path)
T}
T{
\f[V]type\f[R]
T}@T{
MIME type of the file (e.g., \[lq]text/plain\[rq],
\[lq]application/pdf\[rq])
T}
T{
\f[V]size\f[R]
T}@T{
File size in bytes
T}
T{
\f[V]modified\f[R]
T}@T{
Last modification time (ISO 8601 format, e.g.,
\[lq]2025-04-15T10:30:45\[rq])
T}
.TE
.SS Content Element
.PP
.TS
tab(@);
lw(32.1n) lw(37.9n).
T{
Attribute
T}@T{
Description
T}
_
T{
\f[V]encoding=\[dq]base64\[dq]\f[R]
T}@T{
Present for binary files or compressed content
T}
T{
\f[V]compression=\[dq]gzip\[dq]\f[R]
T}@T{
Present when compression is enabled with \[en]compress
T}
T{
\f[V]error=\[dq]failed_to_encode\[dq]\f[R]
T}@T{
Present when binary file encoding fails
T}
T{
\f[V]error=\[dq]failed_to_process_cdata\[dq]\f[R]
T}@T{
Present when text file CDATA processing fails
T}
T{
\f[V]excluded=\[dq]metadata_only\[dq]\f[R]
T}@T{
Present when \[en]no-content option is used
T}
.TE
.SS Error Handling
.PP
When processing files, the script continues despite individual file
errors, allowing batch processing to complete even if some files cannot
be processed.
Error attributes in the XML output provide information about what went
wrong with specific files.
.SS Implementation Details
.SS Text vs Binary Detection
.PP
The script uses \f[V]file --mime-encoding\f[R] to determine if a file
should be treated as text or binary: - Text files are embedded directly
as CDATA sections - Binary files are encoded with base64
.SS Directory Processing
.PP
When processing directories, the script: 1.
Recursively finds all files in the specified directories using
\f[V]find\f[R] 2.
Filters files against ignore patterns using multiple matching strategies
3.
Intelligently prunes directories that match ignore patterns before
traversing them (for performance) 4.
Handles each file according to its type (text or binary) 5.
Automatically deduplicates files that appear multiple times in the input
.SS Git Integration
.PP
When using \f[V]--gitdir\f[R], the script: 1.
Verifies the specified directory is a valid Git repository (contains
\&.git directory) 2.
Uses \f[V]git ls-files\f[R] to get all tracked files in the repository
3.
Filters files against ignore patterns (same as directory processing) 4.
Processes each file and includes it in the XML output 5.
Preserves the current working directory (changes directory only
temporarily) 6.
Handles absolute paths correctly for all git-tracked files
.SS Error Handling
.PP
The script implements robust error handling: - Continues processing when
individual files fail (non-fatal errors) - Provides detailed error
messages through stderr - Uses proper exit codes for different failure
scenarios - Includes error attributes in XML for problematic files -
Traps errors to provide context-specific failure information - Skips
files exceeding the maximum size limit with appropriate messages
.SS Symlink Resolution
.PP
Symbolic links are resolved to their actual target files using
\f[V]readlink -m\f[R] to ensure: 1.
The actual file content is processed, not the symlink itself 2.
Absolute canonical paths are used for all file references 3.
File deduplication works correctly even with multiple links to the same
file 4.
Path attributes in the XML always refer to canonical file locations
.SS Integration in Scripts
.PP
The \f[V]files2xml\f[R] script can be sourced in other Bash scripts to
use its functions directly:
.IP
.nf
\f[C]
source /path/to/files2xml

# Use the files_to_xml function directly
files_to_xml file1.txt file2.txt | process_xml
\f[R]
.fi
.SS Requirements
.IP \[bu] 2
\f[B]Bash\f[R]: Version 5.2.21 or higher (for associative arrays and
other features)
.IP \[bu] 2
\f[B]Git\f[R]: For repository integration functionality (optional, only
required when using \[en]gitdir)
.IP \[bu] 2
\f[B]Standard Unix utilities\f[R]:
.RS 2
.IP \[bu] 2
\f[V]basename\f[R]: For extracting filenames
.IP \[bu] 2
\f[V]file\f[R]: For MIME type and encoding detection
.IP \[bu] 2
\f[V]stat\f[R]: For file metadata
.IP \[bu] 2
\f[V]date\f[R]: For formatting timestamps
.IP \[bu] 2
\f[V]sed\f[R]: For processing text content and CDATA handling
.IP \[bu] 2
\f[V]base64\f[R]: For encoding binary files
.IP \[bu] 2
\f[V]readlink\f[R]: For resolving symlinks and canonical paths
.IP \[bu] 2
\f[V]numfmt\f[R]: For human-readable file size conversion
.IP \[bu] 2
\f[V]getopt\f[R]: For command-line argument parsing
.IP \[bu] 2
\f[V]gzip\f[R]: For content compression (only required when using
\[en]compress)
.IP \[bu] 2
\f[V]find\f[R]: For directory traversal
.RE
.PP
The script automatically checks for required dependencies and will
display an error message if any are missing.
.SS Troubleshooting
.SS Common Issues
.IP \[bu] 2
\f[B]\[lq]No input files specified\[rq]\f[R]: Ensure you\[cq]ve provided
file paths, directories, or used \f[V]--gitdir\f[R].
.IP \[bu] 2
\f[B]\[lq]File too large\[rq]\f[R]: Use \f[V]--max-file-size\f[R] with a
larger value if needed (e.g., \f[V]--max-file-size 2G\f[R]).
.IP \[bu] 2
\f[B]\[lq]Required command not found\[rq]\f[R]: Ensure all listed
utilities are installed and in your PATH.
.IP \[bu] 2
\f[B]\[lq]No .git directory\[rq]\f[R]: Verify the path provided to
\f[V]--gitdir\f[R] is a valid Git repository.
.IP \[bu] 2
\f[B]\[lq]Failed to resolve path\[rq]\f[R]: Check the file exists and
has correct permissions.
.IP \[bu] 2
\f[B]\[lq]Invalid \[en]max-file-size format\[rq]\f[R]: Use proper format
with suffix (K, M, G, etc.).
.SS File Processing Errors
.PP
If specific files fail to process: 1.
Check file permissions (must be readable by the user running the script)
2.
Verify the file isn\[cq]t corrupted (try opening it with other
applications) 3.
Confirm the file size is within limits (check with
\f[V]ls -lh filename\f[R]) 4.
Check if the file is being ignored by a pattern (run with \f[V]-v\f[R]
for verbose output) 5.
Ensure special files (devices, sockets, etc.)
are not included (only regular files are supported)
.SS Debugging
.PP
If you encounter issues: 1.
Run with increased verbosity (\f[V]-v\f[R] or \f[V]-vv\f[R]) to see
detailed processing information 2.
Check stderr for detailed error messages
(\f[V]./files2xml ... 2>errors.log\f[R]) 3.
Verify XML output validity with xmllint
(\f[V]./files2xml ... | xmllint --format -\f[R]) 4.
For Git integration issues, verify Git is installed and working
(\f[V]git --version\f[R])
.SS License
.PP
GPL-3 License
